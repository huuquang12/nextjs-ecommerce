let assert = require('assert');
let exec = require('child_process').execSync;

<<<<<<< HEAD
=======
const PROJECT_DIR = process.env.PROJECT_DIR;
const JAKE_CMD = `${PROJECT_DIR}/bin/cli.js`;

>>>>>>> 1ed7fbf0e136bc57b0b3e1818b20dbfb83ba5d29
suite('concurrent', function () {

  this.timeout(7000);

  test(' simple concurrent prerequisites 1', function () {
<<<<<<< HEAD
    let out = exec('./node_modules/.bin/jake -q concurrent:simple1').toString().trim()
=======
    let out = exec(`${JAKE_CMD} -q concurrent:simple1`).toString().trim()
>>>>>>> 1ed7fbf0e136bc57b0b3e1818b20dbfb83ba5d29
    assert.equal('Started A\nStarted B\nFinished B\nFinished A', out);
  });

  test(' simple concurrent prerequisites 2', function () {
<<<<<<< HEAD
    let out = exec('./node_modules/.bin/jake -q concurrent:simple2').toString().trim()
=======
    let out = exec(`${JAKE_CMD} -q concurrent:simple2`).toString().trim()
>>>>>>> 1ed7fbf0e136bc57b0b3e1818b20dbfb83ba5d29
    assert.equal('Started C\nStarted D\nFinished C\nFinished D', out);
  });

  test(' sequential concurrent prerequisites', function () {
<<<<<<< HEAD
    let out = exec('./node_modules/.bin/jake -q concurrent:seqconcurrent').toString().trim()
=======
    let out = exec(`${JAKE_CMD} -q concurrent:seqconcurrent`).toString().trim()
>>>>>>> 1ed7fbf0e136bc57b0b3e1818b20dbfb83ba5d29
    assert.equal('Started A\nStarted B\nFinished B\nFinished A\nStarted C\nStarted D\nFinished C\nFinished D', out);
  });

  test(' concurrent concurrent prerequisites', function () {
<<<<<<< HEAD
    let out = exec('./node_modules/.bin/jake -q concurrent:concurrentconcurrent').toString().trim()
=======
    let out = exec(`${JAKE_CMD} -q concurrent:concurrentconcurrent`).toString().trim()
>>>>>>> 1ed7fbf0e136bc57b0b3e1818b20dbfb83ba5d29
    assert.equal('Started A\nStarted B\nStarted C\nStarted D\nFinished B\nFinished C\nFinished A\nFinished D', out);
  });

  test(' concurrent prerequisites with subdependency', function () {
<<<<<<< HEAD
    let out = exec('./node_modules/.bin/jake -q concurrent:subdep').toString().trim()
=======
    let out = exec(`${JAKE_CMD} -q concurrent:subdep`).toString().trim()
>>>>>>> 1ed7fbf0e136bc57b0b3e1818b20dbfb83ba5d29
    assert.equal('Started A\nFinished A\nStarted Ba\nFinished Ba', out);
  });

  test(' failing in concurrent prerequisites', function () {
    try {
<<<<<<< HEAD
      exec('./node_modules/.bin/jake -q concurrent:Cfail');
=======
      exec(`${JAKE_CMD} -q concurrent:Cfail`);
>>>>>>> 1ed7fbf0e136bc57b0b3e1818b20dbfb83ba5d29
    }
    catch(err) {
      assert(err.message.indexOf('Command failed') > -1);
    }
  });

});
